<?php

namespace EducationalExample;

class SafeOperation {
    public $logMessage;

    public function __construct($params) {
        if (isset($params['log'])) {
            $this->logMessage = $params['log'];
        }
    }

    public function logExampleMessage() {
        // Simulate an educational log action
        echo "This is an educational example of PHP object injection.\n";
    }

    // Destructor method to trigger the educational action
    public function __destruct() {
        if ($this->logMessage === 'logExampleMessage') {
            $this->logExampleMessage();
        }
    }
}

// Simulate receiving a POST request
$requestBody = file_get_contents('php://input');
parse_str($requestBody, $parsedBody);

if (isset($parsedBody['config'])) {
    // Decode JSON from 'config' parameter
    $config = json_decode($parsedBody['config'], true);

    if (isset($config['as xyz'])) {
        // Simulate unsafe unserialize operation
        $serializedData = serialize($config['as xyz']);
        
        // Warning: This is intentionally vulnerable to demonstrate object injection!
        $object = unserialize($serializedData);

        // Output for educational purposes
        echo "Processed the request safely.\n";
    } else {
        echo "Invalid configuration provided.\n";
    }
} else {
    echo "No configuration found.\n";
}
